import os

model = ARGUMENTS.get('MODEL')
core_dir = ARGUMENTS.get('CORE_DIR')
output_root = ARGUMENTS.get('OUTPUT')

env = Environment(
    tools=['default', 'mingw'],
    CPPPATH=[
        Dir(f'{core_dir}/include'),
        Dir(f'{core_dir}/external/ANN/include'),
    ],
    LIBPATH=[
        Dir(f'{output_root}/external/ANN/src'),
        Dir(f'{output_root}/src'),
    ],
    ENV=os.environ,
    # When MSVC (or any other compilers) are supported, update this to be a compiler-specific flag
    CXXFLAGS=['-std=c++14'],
)

Export('env')
SConscript(f'{core_dir}/external/ANN/src/SConscript', variant_dir=f'{output_root}/external/ANN/src', duplicate=False)
SConscript(f'{core_dir}/src/SConscript', variant_dir=f'{output_root}/src', duplicate=False)

env.Program('ssa_sdpd', model, LIBS=['spatialpy-core', 'ANN'])
